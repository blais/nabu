==================
    TODO: nabu
==================

.. contents::
..
    1  Misc
    2  Server Setup
    3  Directives
    4  Extractors

Misc
====

- All the astext() functions from the extractors should be replaced by a
  function that checks for the presence of lists, and concatenate if the arg is
  a list.  See book() for example.

- Skip symbolic links by default.

- Fix Nabu in that if there is an error, the client script should keep going
  to try to publish the other documents.

- Can I use views to hide the disclosure requirement in my queries entirely? e.g.::

    CREATE VIEW documents_public AS SELECT * FROM document;
    CREATE VIEW documents_shared AS SELECT * FROM document WHERE disclosure > 1;
    CREATE VIEW documents_private AS SELECT * FROM document WHERE disclosure > 2;

  And the same for all the remaining tables?  All the queries would then have to
  append the correct names from the tables they fetch from.

- We need to provide a way for the extractors to reliably report errors, some
  sort of function.

- You need to define a syntax for multiple links sharing the same description
  and keywords

- When an error occurs during upload, we should log the trace of the exception
  to the logging module, in order to be able to debug problems easily. (see
  gijsbert's email).

- We need to process the transforms within a single transaction, and to roll it
  back if there is an error, including rolling back the original deletions from
  all the table.  The point is that we want to maintain database consistency
  even if there is an error while processing the document.  This is very
  important!

- Make the source storage objects use a acquire/release pattern compatible with
  antipool, so that we could create them once in a mod_python handler rather
  than every time.

- When we change a document's unique Id, the old document remains in the
  databaseâ€¦ is there anything we can do about that?

- We need to detect encoding errors better, I have too many documents which do
  not get detected/guessed automatically

- Write an extractor for all my google maps links and create a list of them, so
  I can find locations easily.  MapExtractor

- Write an extractor for dictionary definitions;  in this format:

    defn: unwonted
       Definition of unwontedness.


- Find how to suppress output of errors in HTML conversion, to avoid catching
  this output in the extractors and having this output pollute the contents of
  the extractors.

    e.g. photography.txt and contacts.

- Nabu ``-l`` is broken.

- Test and check with docutils 0.4

- Revise and fix ``client.py --dump``

- Add a "--config=" option to client rather than force setting NABURC.

- Make the html rendering not render output errors.

- support encrypted files from the publisher

  - problem: how do we identify documents to be published without decrypting?

    - emacs config must keep plain text at the top of the file when decrypting
      in a variable and add it back in when reencrypting

- shares some of the advantages of XML, structured hirarchical tree of nodes


Server Setup
============
- implement asynchronous document processing on the server

- check database locking issues in more detail?


Directives
==========

- Do something about the locator directive

Extractors
==========

- warn on files that have no titles (add minimum requirements extractor)

- there should be and .. end directive to stop the processing from that point on.
  - .. disclosure:: private directive could achieve something similar

- add a generic field list parser for creating new types of records without
  code: the entry type is the first field list, if it matches some pattern
  (e.g. if it's empty);

- url extractor: when right after a title, a list of URLs should use the title
  as the description string

